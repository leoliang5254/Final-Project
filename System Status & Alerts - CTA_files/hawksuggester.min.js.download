(function (HawkSearch) {
    HawkSearch.suggestInit = function (queryField, settings) {
        $.fn.hawksearchSuggest = function (settings) {
            settings = $.extend({ isAutoWidth: !1, isInstatSearch: !1, value: $('#hdnhawkkeyword').val() }, settings); return this.each(function () { var suggestQueryField = $(this); var opts = optionsHandler(suggestQueryField, settings) }); function optionsHandler(suggestQueryField, settings) {
                var suggestQueryFieldNode = suggestQueryField[0]; suggestQueryFieldNode.autocomplete = "off"; $(suggestQueryField).val(settings.value); HawkSearch.SuggesterGlobal.defaultKeyword[$(suggestQueryField).attr('id')] = settings.value; suggestQueryField.on("keyup", keypressHandler); suggestQueryField.on("focus", function (e) { HawkSearch.SuggesterGlobal.focus = !0 }); if (settings.hiddenDivName) { HawkSearch.SuggesterGlobal.divName = settings.hiddenDivName } else { HawkSearch.SuggesterGlobal.divName = "querydiv" }; function suggestLookup(suggestQueryField, settings) {
                    var val = suggestQueryField.val(); if ((HawkSearch.SuggesterGlobal.lastVal != val || HawkSearch.SuggesterGlobal.lastVal != "") && HawkSearch.SuggesterGlobal.focus && HawkSearch.SuggesterGlobal.searching == !1) { HawkSearch.SuggesterGlobal.lastVal = val; suggestDoRemoteQuery(escape(val)) }
                    return !0
                }; function suggestDoRemoteQuery(val) {
                    HawkSearch.SuggesterGlobal.searching = !0; var req = settings.lookupUrlPrefix; var visitorId = HawkSearch.lilBro.event.getVisitorId(); var keywordField = $("#hdnhawkkeywordfield").val(); var kw = $("#" + keywordField).val(); var hawkb = HawkSearch.GetQueryStringValue.hawkb; if (hawkb !== undefined) { req = req + '&hawkb=' + hawkb }
                    jQuery.ajax({ type: "GET", contentType: "application/json; charset=utf-8", url: req + '&q=' + escape(val) + '&hawkvisitorid=' + visitorId + '&' + keywordField + '=' + encodeURIComponent(kw), data: "", dataType: "jsonp", success: function (autoSuggestResult) { showQueryDiv(autoSuggestResult); HawkSearch.SuggesterGlobal.searching = !1 }, error: function () { HawkSearch.SuggesterGlobal.searching = !1 } })
                }; function getSuggestDiv(divId) {
                    if (!HawkSearch.SuggesterGlobal.globalDiv) {
                        if (!document.getElementById(divId)) { var newNode = document.createElement("div"); newNode.setAttribute("id", divId); newNode.setAttribute("class", "hawk-searchQuery"); document.body.appendChild(newNode) }
                        HawkSearch.SuggesterGlobal.globalDiv = document.getElementById(divId); HawkSearch.SuggesterGlobal.queryDiv = $("#" + divId)
                    }
                    if (suggestQueryField && (suggestQueryField.offset().left != HawkSearch.SuggesterGlobal.storedOffset)) {
                        var x = suggestQueryField.offset().left, y = suggestQueryField.offset().top + suggestQueryField.outerHeight(), fieldID = suggestQueryField.attr("id"); HawkSearch.SuggesterGlobal.storedOffset = x; if (!HawkSearch.SuggesterGlobal.divFormatted) {
                            HawkSearch.SuggesterGlobal.queryDiv.removeAttr("style").css({ "left": x, "top": y }).attr("class", "hawk-searchQuery hawk-searchQuery-" + fieldID); if (settings && settings.isAutoWidth) {
                                var queryWidth = suggestQueryField.outerWidth(); var minValue = 250; if (queryWidth < minValue) { queryWidth = minValue }
                                HawkSearch.SuggesterGlobal.queryDiv.css("width", queryWidth)
                            }
                        }
                    }; return HawkSearch.SuggesterGlobal.queryDiv
                }; function suggestIsAbove() { if (settings.isAbove) { var queryHeight = HawkSearch.SuggesterGlobal.queryDiv.outerHeight(!0); var y = suggestQueryField.offset().top - queryHeight; HawkSearch.SuggesterGlobal.queryDiv.css({ "top": y }); if (!HawkSearch.SuggesterGlobal.queryDiv.hasClass("hawk-queryAbove")) { HawkSearch.SuggesterGlobal.queryDiv.addClass("hawk-queryAbove") } } }; function keypressHandler(e) {
                    var suggestDiv = getSuggestDiv(HawkSearch.SuggesterGlobal.divName), divNode = suggestDiv[0]; if (suggestDiv.is(":hidden")) { }
                    if (!e && window.event) { e = window.event }
                    var key; if (window.event) { key = e.keyCode } else { key = e.which }
                    var KEYUP = 38; var KEYDOWN = 40; var KEYENTER = 13; var KEYTAB = 9; if ((key != KEYUP) && (key != KEYDOWN) && (key != KEYENTER) && (key != KEYTAB)) { suggestLookup(suggestQueryField, settings, e); return !0 }; var selectedIndex = getSelectedItem(suggestDiv); var selectedItem; if (key == KEYENTER) { if (selectedIndex >= 0) { var selectedItem = setSelectedItem(suggestDiv, selectedIndex); _selectResult(selectedItem); e.cancelBubble = !0; if (window.event) { return !1 } else { e.preventDefault() } } else { hideSuggest(e); return !0 } } else if (key == KEYTAB) { if ((selectedIndex + 1) < suggestDiv.find(".hawk-sqItem").length) { e.cancelBubble = !0; e.preventDefault(); selectedItem = setSelectedItem(suggestDiv, selectedIndex + 1) } else { hideSuggest(e) } } else { if (key == KEYUP) { selectedItem = setSelectedItem(suggestDiv, selectedIndex - 1) } else if (key == KEYDOWN) { selectedItem = setSelectedItem(suggestDiv, selectedIndex + 1) } }; return !0
                }; function showQueryDiv(autoSuggestResult) {
                    var suggestDiv = getSuggestDiv(HawkSearch.SuggesterGlobal.divName), divNode = suggestDiv[0]; if (autoSuggestResult === null || (autoSuggestResult.Count === 0 && autoSuggestResult.ContentCount === 0)) { showSuggest(!1); return }
                    while (divNode.childNodes.length > 0)
                        divNode.removeChild(divNode.childNodes[0]); var categories = autoSuggestResult.Categories; var popular = autoSuggestResult.Popular; var products = autoSuggestResult.Products; var content = autoSuggestResult.Content; showTerms(suggestDiv, popular, "Popular Searches", HawkSearch.LilBro.Schema.AutoCompleteClick.AutoCompleteType.popular); showTerms(suggestDiv, categories, "Top Product Categories", HawkSearch.LilBro.Schema.AutoCompleteClick.AutoCompleteType.category); var productsTitle = (products.length == 1 ? "Top Result Match" : "Top " + products.length + " Result Matches"); showProducts(suggestDiv, products, productsTitle); var contentTitle = (content.length == 1 ? "Top Result Match" : "Top " + content.length + " Result Matches"); showContent(suggestDiv, content, contentTitle); if (categories.length > 0 || popular.length > 0 || products.length > 0 || content.length > 0) { showFooter(suggestDiv, autoSuggestResult.Count, autoSuggestResult.ContentCount, autoSuggestResult.SearchWebsiteUrl, autoSuggestResult.KeywordField); showSuggest(!0) }
                }; function showSuggest(show) { var suggestDisplay = getSuggestDiv(HawkSearch.SuggesterGlobal.divName); if (show === !1) { suggestDisplay.hide(); $("body").off("click", hideSuggest) } else { suggestDisplay.show(); $("body").on("click", hideSuggest) } }; function hideSuggest(e) { var updatedDisplay = !1; if (!updatedDisplay && $(e.target).closest(".hawk-searchQuery").length <= 0) { showSuggest(!1); updatedDisplay = !0 } }; function isEven(num) { if (num !== !1 && num !== !0 && !isNaN(num)) { return num % 2 == 0 } else return !1 }; function showTerms(suggestDiv, terms, title, type) {
                    if (terms.length >= 1) {
                        suggestDivNode = suggestDiv[0]; var suggestHeader = document.createElement("div"); suggestHeader.className = "hawk-sqHeader"; suggestHeader.innerHTML = title; suggestDivNode.appendChild(suggestHeader); var suggestContent = document.createElement("ul"); suggestContent.className = "hawk-sqContent"; suggestDivNode.appendChild(suggestContent); var resultItems = ""; for (var i = 0; i < terms.length; i++) {
                            var term = terms[i]; if (term.Value == null) continue; var resultItem = document.createElement("li"); resultItem.setAttribute('data-url', term.Url); resultItem.setAttribute("data-autoCompleteType", type); if (isEven(i)) { resultItem.className = "hawk-sqItem term" } else { resultItem.className = "hawk-sqItem hawk-sqItemAlt term" }; var resultItemContent = document.createElement("h1"); resultItemContent.className = "hawk-sqItemName"; resultItemContent.innerHTML = term.Value
                            resultItem.appendChild(resultItemContent); suggestContent.appendChild(resultItem)
                        }; var suggestItems = suggestDiv.find(".hawk-sqContent .hawk-sqItem"); suggestItemHandler(suggestItems); suggestIsAbove()
                    }
                }; function showProducts(suggestDiv, products, title) { if (products.length >= 1) { suggestDivNode = suggestDiv[0]; var suggestHeader = document.createElement("div"); suggestHeader.className = "hawk-sqHeader"; suggestHeader.innerHTML = title; suggestDivNode.appendChild(suggestHeader); var suggestContent = document.createElement("ul"); suggestContent.className = "hawk-sqContent"; suggestDivNode.appendChild(suggestContent); for (var i = 0; i < products.length; i++) { var product = products[i]; var resultItem = document.createElement("li"); if (isEven(i)) { resultItem.className = "hawk-sqItem" } else { resultItem.className = "hawk-sqItem hawk-sqItemAlt" }; resultItem.setAttribute('data-url', product.Url); resultItem.setAttribute("data-autoCompleteType", HawkSearch.LilBro.Schema.AutoCompleteClick.AutoCompleteType.product); resultItem.innerHTML = product.Html; suggestContent.appendChild(resultItem) }; var suggestItems = suggestDiv.find(".hawk-sqContent .hawk-sqItem"); suggestItemHandler(suggestItems) } }; function showFooter(suggestDiv, count, contentCount, url, keywordfield) { var footerContainer = document.createElement("div"); footerContainer.className = "hawk-sqFooter"; var footerLink = document.createElement("a"); footerLink.href = "javascript:void(0);"; footerLink.setAttribute("onclick", "window.location='" + url + "?" + keywordfield + "=" + escape($(queryField).val()) + HawkSearch.preserveUrlParams() + "'"); footerLink.innerHTML = "View All Matches"; var footerCount = document.createElement("div"); footerCount.style.marginTop = "3px"; footerCount.style.fontSize = ".85em"; footerCount.innerHTML = count + " product(s)"; footerContainer.appendChild(footerLink); footerContainer.appendChild(footerCount); suggestDiv.append(footerContainer); suggestIsAbove() }; function showContent(suggestDiv, content, title) {
                    if (content.length >= 1) {
                        suggestDivNode = suggestDiv[0]; var suggestHeader = document.createElement("div"); suggestHeader.className = "hawk-sqHeader"; suggestHeader.innerHTML = title; suggestDivNode.appendChild(suggestHeader); var suggestContent = document.createElement("ul"); suggestContent.className = "hawk-sqContent"; suggestDivNode.appendChild(suggestContent); for (var i = 0; i < content.length; i++) {
                            var product = content[i]; var resultItem = document.createElement("li"); if (isEven(i)) { resultItem.className = "hawk-sqItem term" } else { resultItem.className = "hawk-sqItem hawk-sqItemAlt term" }; resultItem.setAttribute('data-url', product.Url); resultItem.setAttribute("data-autoCompleteType", HawkSearch.LilBro.Schema.AutoCompleteClick.AutoCompleteType.content); resultItem.innerHTML = product.Html
                            suggestContent.appendChild(resultItem)
                        }; var suggestItems = suggestDiv.find(".hawk-sqContent .hawk-sqItem"); suggestItemHandler(suggestItems)
                    }
                }; function suggestItemHandler(suggestItems) { suggestItems.on("mouseenter mouseleave", function (e) { var sqItem = $(e.currentTarget); if (e.type === "mouseenter") { highlightResult(sqItem) } else { unhighlightResult(sqItem) } }); suggestItems.off('click').on("click", SuggestedItemClick) }; function SuggestedItemClick(e) {
                    e.preventDefault(); var suggest_type = $(e.target).closest("li").attr("data-autoCompleteType"); var name = $(e.target).text().replace(/\u00bb/g, "&raquo;"); if (name === "") { name = $(e.target).parents(".hawk-sqActive").find("div.hawk-sqItemContent h1").text() }
                    var itemUrl = $(e.currentTarget).data("url"); var keyword = $("#" + $("#hdnhawkkeywordfield").val()).val(); if (HawkSearch.Tracking.CurrentVersion() == HawkSearch.Tracking.Version.v2) { HawkSearch.Tracking.writeAutoCompleteClick(keyword, e, suggest_type, name, itemUrl) }
                    else if (HawkSearch.Tracking.CurrentVersion() == HawkSearch.Tracking.Version.v2AndSQL) { HawkSearch.Tracking.writeAutoCompleteClick(keyword, e, suggest_type, name, itemUrl); HawkSearch.Tracking.V1.autosuggestClick(keyword, name, itemUrl, suggest_type) }
                    else { HawkSearch.Tracking.V1.autosuggestClick(keyword, name, itemUrl, suggest_type) }
                    window.location = itemUrl
                }; function selectResult(item) { _selectResult(item) }; function _selectResult(item) { itemUrl = item.data("url"); window.location = itemUrl }; function highlightResult(item) { $(HawkSearch.SuggesterGlobal.globalDiv).find(".hawk-sqItem").removeClass("hawk-sqActive"); _highlightResult(item) }; function _highlightResult(item) { if (item == null) return; item.addClass("hawk-sqActive") }; function unhighlightResult(item) { _unhighlightResult(item) }; function _unhighlightResult(item) { item.removeClass("hawk-sqActive") }; function getSelectedItem(suggestDiv) {
                    var count = -1; var sqItems = suggestDiv.find(".hawk-sqItem"); if (sqItems) { if (sqItems.filter(".hawk-sqActive").length == 1) { count = sqItems.index(sqItems.filter(".hawk-sqActive")) } }
                    return count
                }; function setSelectedItem(suggestDiv, selectedIndex) { var count = -1; var selectedItem = null; var first = null; var sqItems = suggestDiv.find(".hawk-sqItem"); if (sqItems) { for (var i = 0; i < sqItems.length; i++) { if (first == null) { first = sqItems.eq(i) }; if (++count == selectedIndex) { _highlightResult(sqItems.eq(i)); selectedItem = sqItems.eq(i) } else { _unhighlightResult(sqItems.eq(i)) } } }; if (selectedItem == null && (selectedIndex < 0)) { selectedItem = sqItems.eq(-1); _highlightResult(selectedItem) } else if (selectedItem == null) { selectedItem = first; _highlightResult(selectedItem) }; return selectedItem }
            }
        }; $(queryField).hawksearchSuggest(settings)
    }
}(window.HawkSearch = window.HawkSearch || {}))